# Create Archive With Application

In this step we'll create zip archive containing correctly packaged built files.

# Add Packaging Rules

To package built artifact you'll need special [packaging rules](https://github.com/bazelbuild/rules_pkg).

For that we have to add loading descriptors into `WORKSPACE`:

```
http_archive(
    name = "rules_pkg",
    urls = [
        "https://mirror.bazel.build/github.com/bazelbuild/rules_pkg/releases/download/0.5.1/rules_pkg-0.5.1.tar.gz",
        "https://github.com/bazelbuild/rules_pkg/releases/download/0.5.1/rules_pkg-0.5.1.tar.gz",
    ],
    sha256 = "a89e203d3cf264e564fcb96b6e06dd70bc0557356eb48400ce4b5d97c2c3720d",
)
load("@rules_pkg//:deps.bzl", "rules_pkg_dependencies")
rules_pkg_dependencies()

```

Now we'll have rules which will provide ability to create file structures and package everything in zip or tar archives.
Let's add rules to package all the files in the way we want.

Add Following to root BUILD.bazel

```
pkg_files(
    name = "package_busy_box",
    srcs = [
        "assets/scripts/server.sh",
        "//cmd/busybox",
    ],
    # Where it should be in the final package
    prefix = "bin",
)
```

It'll create following directory structure:

```
/bin
    /busybox
    /server.sh
```

Now let's package it

```
pkg_zip(
    name = "busy_box_archive",
    srcs = [
        ":package_busy_box",
    ],
    package_file_name = "busy_box.zip",
)
```

It'll create zip achieve with generated content on package step.

# Add Application Version

Let's add application version to archive name. For that let's create special build file with version constant.
Create `version.bzl` file on the application root directory with following content:

```
VERSION = "0.0.5"
```

Now let's access this constant from root build file:

```
load("//:version.bzl", "VERSION")
```

It'll add `VERSION` variable from created `version.bzl` file in current context. Now let's use it in zip name:

```
pkg_zip(
    name = "busy_box_archive",
    srcs = [
        ":package_busy_box",
    ],
    package_file_name = "busy_box_" + VERSION + ".zip",
)
```

Now let's check what wll be generated by this step:

```
â‡’  bazel build //:busy_box_archive
INFO: Analyzed target //:busy_box_archive (9 packages loaded, 250 targets configured).
INFO: Found 1 target...
Target //:busy_box_archive up-to-date:
  bazel-bin/busy_box_0.0.5.zip
INFO: Elapsed time: 5.697s, Critical Path: 1.89s
INFO: 6 processes: 3 internal, 3 darwin-sandbox.
INFO: Build completed successfully, 6 total actions

```

Step generated following archive `bazel-bin/busy_box_0.0.5.zip`.